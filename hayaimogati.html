<html>
  <head>
    <meta charset="UTF-8">
    <title>早い者勝ち</title>
  </head>
  <body>
    <h1>あ</h1>
    <form id="FormPlayerData">
      <label id="LabelPlayerID">
        <span>プレイヤーＩＤ</span>
        <input type="number" min="0" step="1" />
      </label>
      <button type="submit" id="FormPlayerDataSubmit">探す</button>
    </form>
		<div id="DivResult"></div>
  </body>
  <script>
(async()=> {
"use strict";

async function getJSON(link){
	const response = await fetch(link);
	return response.json();
}

const HayaData = await getJSON("./test.json");
const Missions = HayaData["Ms"];
const Players = HayaData["Ps"];
document.getElementById("FormPlayerDataSubmit").addEventListener("click", () => {
	event.preventDefault();
	const player_id = document.querySelector("#LabelPlayerID input").value;
	const player_name = Players[player_id];
	if(!player_name){
		alert("プレイヤーがいません。");
		return;
	}
	const datas = [];
	for(const [mission_id, mission_data] of Object.entries(Missions)){
		for(let i = 0; i < mission_data["Ws"].length; i++){
			const windata = mission_data["Ws"][i];
			if(windata[0] === player_id){
				const o = {};
				o["L"] = mission_data["L"];
				o["D"] = mission_data["D"];
				o["I"] = mission_data["I"];
				o["R"] = i + 1;
				o["P"] = windata[1];
				datas.push(o);
			}
		}
	}

	const result_div = document.getElementById("DivResult");
	result_div.innerHTML = "";
	const sum_table = document.createElement("table");
	const data_table = document.createElement("table");
	let th_levels = 0;
	let th_eps = 0;
	{
		const table = sum_table;
		const caption = document.createElement("caption");
		caption.textContent = `${player_name}さんのクエストデータ`;
		table.append(caption);
		const thead = document.createElement("thead");
		table.append(thead);
		{
			const tr = document.createElement("tr");
			thead.append(tr);
			{
				const th = document.createElement("th");
				th.textContent = "レベル";
				tr.append(th);
			}
			{
				const th = document.createElement("th");
				th.textContent = "内容";
				tr.append(th);
			}
			{
				const th = document.createElement("th");
				th.textContent = "順位";
				tr.append(th);
			}
			{
				const th = document.createElement("th");
				th.textContent = "獲得ep";
				tr.append(th);
			}
		}
		const tbody = document.createElement("tbody");
		table.append(tbody);
		datas.forEach((data) => {
			const tr = document.createElement("tr");
			tbody.append(tr);
			{
				const td = document.createElement("td");
				td.textContent = data["L"];
				tr.append(td);
				th_levels += Number(data["L"]);
			}
			{
				const td = document.createElement("td");
				td.textContent = data["D"];
				tr.append(td);
			}
			{
				const td = document.createElement("td");
				td.textContent = data["R"];
				tr.append(td);
			}
			{
				const td = document.createElement("td");
				td.textContent = data["P"];
				tr.append(td);
				th_eps += Number(data["P"]);
			}
		});
	}
	{
		const table = sum_table;
		const caption = document.createElement("caption");
		caption.textContent = `${player_name}さんのデータまとめ`;
		table.append(caption);
		const thead = document.createElement("thead");
		table.append(thead);
		{
			const tr = document.createElement("tr");
			thead.append(tr);
			{
				const th = document.createElement("th");
				th.textContent = "レベル";
				tr.append(th);
			}
			{
				const th = document.createElement("th");
				th.textContent = "獲得ep";
				tr.append(th);
			}
		}
		const tbody = document.createElement("tbody");
		table.append(tbody);
		{
			const tr = document.createElement("tr");
			tbody.append(tr);
			{
				const td = document.createElement("td");
				td.textContent = th_levels;
				tr.append(td);
			}
			{
				const td = document.createElement("td");
				td.textContent = th_eps;
				tr.append(td);
			}
		}
	}
	result_div.append(sum_table);
	result_div.append(data_table);
});

/*
const textarea = document.createElement("textarea");
let putData = [];
for(const [mission_id, mission_data] of Object.entries(Missions)){
	putData.push(mission_id);
}
putData = putData.sort();
textarea.value = putData.join("\n");
document.body.append(textarea);
*/

})();
  </script>
</html>
