<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width">
		<title>MSO_早い者勝ちイベントデータ</title>
	</head>
	<style>
:root{
	--headerHeight: 2ch;
}
*{
	font-size: 16px;
	background-color: #fff;
}
@media (prefers-color-scheme: dark) {
	*{
		background-color: #181a1b;
	}
	*:not(a){
		color: #c8c3bc;
	}
	a:not(:visited){
		color: #69a6d5;
	}
}
body{
	font-family: Open Sans, sans-serif;
	max-width: 70ch;
	margin: auto;
	padding: 0px;
	font-size: 1.10em;
	line-height: 1.75;
	overflow-y: scroll;
}
input[type=checkbox] {
	transform: scale(1.5);
	margin: 1ch;
}
body > header{
	position: sticky;
	top: 0;
	z-index: 10;
	height: var(--HeaderHeight);
}
#NavSiteHeader{
	display: flex;
	justify-content: flex-start;
	align-items: center;
	gap: 1ch;
	border-bottom: solid 2px #888;
}
#NavSiteHeader > h1 > a{
	text-decoration: none;
}
main{
	padding: 0em 1em 3em 1em;
}
a{
	text-decoration: none;
}
a:not(:visited){
	color: #337ab7;
}
table {
	border-collapse: collapse;
	margin: 5ch 0ch;
	width: 100%;
	border-top: solid 1px #444;
/*
	white-space: pre;
*/
}
td, th {
/*
	border-right: dashed 1px #888;
	border-left: dashed 1px #888;
*/
	border-bottom: solid 1px #444;
	padding: 0.5ch 1ch;
}
img {
	width: 2.0ch;
}
label,
button{
	cursor: pointer;
}
table > caption:nth-of-type(1){
	caption-side: top;
}
table > caption:nth-of-type(2){
	caption-side: bottom;
}
main > article:not(.sc){
	display: none;
}
main > article:not([id=toppage]) > section{
	display: flex;
	flex-direction: column;
}
main > article:not([id=toppage]) > section:not(.sc2){
	display: none;
}
.active {
	background-color: #F84;
}
.sortTable th {
	border: outset 3px #888;
	cursor: pointer;
}
.sortTable th:active {
	border-style: inset;
}
main > article > section > table > tbody{
	vertical-align: baseline;
}
.buttonOpenConfigShowTableCol{
	margin: 0em 1em;
}
dialog > article > ul {
	list-style: none;
	padding: 0px;
}
dialog > article > ul > li > label{
	display: flex;
	align-items: baseline;
	
}
dialog > article > ul > li > label > input {
	width: 2ch;
	flex: none;
}
dialog > article > ul > li > label > strong {
	margin-right: 1em;
	width: 10ch;
	display: inline-block;
	flex: none;
}

dialog {
	margin: auto;
	height: 80vh;
	padding: 0px;
}
dialog > article {
	height: 90%;
	overflow-y: scroll;
	padding: 2ch;
	margin: 0px;
	box-sizing: border-box;
}
dialog > footer {
	height: 10%;
	padding: 1ch;
	box-sizing: border-box;
	display: flex;
}
dialog > footer > button{
	width: 100%;
}
a[target=_blank]:after {
	content: "↗️ ";
	justify-content: center;
	align-items: center;
	margin: 0px 0.5ch;
	vertical-align: middle;
}
#sorting_bg{
	position: fixed;
	top: 0px;
	left: 0px;
	background-color: rgba(0, 0, 0, 0.2);
	width: 100%;
	height: 100%;
	display: none;
	align-items: center;
	justify-content: center;
	font-size: 3ch;
}
#sorting_bg.isShow{
	display: flex;
}
#ArticleAllData table ul {
	margin: 0px;
	padding: 0px;
	list-style: none;
}
#ArticleAllData table ul > li {
	white-space: pre;
	height: 2.5ch;
}
#menu:has(> #menucontent.open) {
	width: 100%;
}
#menu {
	position: fixed;
	transition: width 0.5s;
	top: var(--HeaderHeight);
	left: 0px;
	height: calc(100% - var(--HeaderHeight));
	width: 0px;
	display: flex;
	background-color: transparent;
	z-index: 10;
}
#menucontent {
	min-height: 100vh;
	padding-bottom: 10em;
	
	transition: grid-template-columns 0.3s ease-out;
	grid-template-columns: 0fr;
	overflow-y: scroll;
	overflow-x: hidden;
	white-space: nowrap;
	display: flex;
	flex-direction: column;
}
#menucontent.open {
	grid-template-columns: 1fr;
}
#menucontent > * {
	padding: 1em 3em 1em 1em;
	border: none;
	border-bottom: solid 2px #444;
	text-align: left;
	line-height: 1.75;
}
#menucontent > *:first-child{
	border-top: solid 2px #444;
}
#menuback{
	background-color: rgba(0, 0, 0, 0.2);
	flex: 1;
}
#menuopener{
	border: none;
	font-size: 2.5em;
	padding: 0px;
	padding: 0px 16px;
}
#configDataFilter fieldset{
	column-count: 2;
}
#configDataFilter fieldset > label{
	display: block;
}
.buttonMoreRead{
	width: 100%;
	margin: 0px;
}
#AllData_B01 td > span{
	position: sticky;
	top: calc(var(--headerHeight) + 5ch);
}
#NavSiteHeader_shortcuts{
	margin-left: auto;
	margin-right: 1ch;
	display: flex;
	gap: 1ch;
}
#NavSiteHeader_shortcuts > button{
	padding: 1ch;
}
#buttonOpenDataFilter{
	order: 2;
}
#buttonSiteConfig{
	order: 3;
}
#buttonSiteTips{
	order: 4;
}

:where(dialog)::backdrop {
	background: oklch(0% 0 0 / 0.3);
}
/*
:where(dialog),
:where(dialog)::backdrop {
	opacity: 0;
	transition: opacity 300ms ease-out, display 300ms allow-discrete, overlay 300ms allow-discrete;
}
:where(dialog[open]),
:where(dialog[open])::backdrop {
	opacity: 1;
}
@starting-style {
	:where(dialog[open]),
	:where(dialog[open])::backdrop {
		opacity: 0;
	}
}
*/
#SiteTips > article > ul > li {
	padding: 1ch 3vw;
	margin-left: 2em;
	text-indent: -2em;
}
#SiteTips > article > ul > li > dl{
	margin-left: 1em;
	text-indent: -1em;
}
#toppage {
	margin: 0px 3vw;
}
#toppage hr{
	margin: 2em 0em;
}
#toppage > section p {
	text-indent: -2em;
	margin-left: 2em;
}
.tableDetail {
	margin: 0px;
	margin-left: auto;
	grid-template-columns: [key] 1fr [value] minmax(7ch, min-content);
	gap: 0px;
	display: grid;
}
.tableDetail > dt:after {
	content: "：";
}
.tableDetail > dt {
	grid-column: key;
	text-align: right;
}
.tableDetail > dd {
	grid-column: value;
	margin-left: 0px;
	text-align: right;
}
	</style>
	<body>
		<header>
			<nav id="NavSiteHeader">
				<button id="menuopener" type="button">≡</button>
				<h1><a href="./main.htm" target>MSO_早い者勝ちデータ</a></h1>
				<div id="NavSiteHeader_shortcuts">
					<button type="button" onClick="document.getElementById('buttonOpenDataFilter').click();">🧽 </button>
					<button type="button" onClick="document.getElementById('buttonSiteConfig').click();">⚙️ </button>
				</div>
			</nav>
		</header>
		<nav id="menu">
			<div id="menucontent">
				<a href="./main.htm" target>🏠️トップ</a>
				<button type="button" id="buttonOpenDataFilter">🧽 絞り込み</button>
				<button type="button" id="buttonSiteConfig">⚙️ 設定</button>
				<button type="button" id="buttonSiteTips">💡 Tips</button>
			</div>
			<div id="menuback">
			</div>
		</nav>
		<main id="MainContent">
			<article id="toppage">
				<section>
					<h2>ℹ️当サイトについて</h2>
					<p>🟡　<a href="https://minesweeper.online/ja/" target="_blank" rel="noopener noreferrer">Minesweeper.Online</a>さんの早い者勝ちイベントのデータを集めたものです。</p>
					<p>🟡　当コンテンツはMSO様より公認を受けていない非公認のものです。</p>
					<p>🟡　当コンテンツについてMSO様にお問い合わせを絶対にしないでください。</p>
					<p>🟡　問題などありましたら直ちに公開を取りやめいたします。</p>
				</section>
				<hr>
				<section>
					<h2>🗂️ 表示内容について</h2>
					<p>🔵　データを取得した最終時刻は08:50辺りなので、それ以降にクリアしたプレイヤーはデータに含まれていません。</p>
					<p>🔵　プレイヤー名は各シーズン最終日当時のものです。</p>
					<p>🔵　獲得EPは補正値無しのものです。</p>
					<p>🔵　小数は小数点2位未満を四捨五入しています。</p>
				</section>
				<hr>
				<address>
					<h2>👥クレジット</h2>
					<p>🐟️作った人：<a href="https://minesweeper.online/ja/player/16842796" target="_blank" rel="noopener noreferrer">魚頭男</a></p>
					<p>🎲マスタご提供：<a href="https://minesweeper.online/ja/player/11151489" target="_blank" rel="noopener noreferrer">3156(Shima)</a></p>
					<ul>
						<li><a href="https://docs.google.com/spreadsheets/d/1qk5b1yZ7NBL2jD9-RtUVFMSyEVRhDyIpJXTGfR6a1go/edit?gid=2078390436#gid=2078390436" target="_blank" rel="noopener noreferrer">EPと順位</a></li>
					</ul>
				</address>
				<hr>
				<section>
					<h2>✨️ 展望</h2>
					<p>🔵　ページをブクマする（当サイト内で）。</p>
					<p>🔵　ページを共有しやすくする。</p>
					<p>🔵　匿名化する。</p>
					<p>🔵　全体のデータの拡充。</p>
				</section>
				<hr>
				<section>
					<h2>🆙更新履歴</h2>
					<aside>
						<h3>2025/05/21</h3>
						<p>🟢　コンテンツをメニューから選ぶように変更しました。<br/>（コンテンツを替えようと思った場合に元の位置にスクロールし直すのが面倒くさく感じたのがきっかけです。）</p>
						<p>🔵　<a href="./main.htm?page=AllData">全体のデータ</a>にコンテンツを追加しました。</p>
						<p>🔵　分類などを絞り込めるようにしました。<br/><button onClick='document.getElementById("buttonOpenDataFilter").click();'>🧽 絞り込み</button>より変更できます。</p>
						<p>🔵　ソート中に読み込み中である旨を表示するようにしました。</p>
						<p>🔵　ランキングなどのソートをあまりしないような表に関して、「さらに読み込む」ボタンを押して行を徐々に読み込む方式にしました。<br/>描画速度が上がります。<br/>なお、従来のように一気に読み込みたい場合は、<button onClick='document.getElementById("buttonSiteConfig").click();'>⚙️ 設定</button>より変更できます。</p>
						<p>🟢　クエスト内容の省略表記を一部変更しました。
							<ul>
								<li>コイン：300コイン → コイン300枚</li>
								<li>宝石：1サファイア → サファイア1個</li>
								<li>アリーナ：L4以上の速度アリーナ → 速度アリーナL4以上</li>
							</ul>
						</p>
					</aside>
					<aside>
						<h3>2025/05/10</h3>
						<p>🔵　ミッションデータに人気度を追加しました。</p>
						<p>🔵　注意書きを🔰READMEに変更し、内容を追記しました。</p>
						<p>🔵　ミッション詳細からカスタム盤面へ飛べるようにしました。<br/><a href="./main.htm?page=MissionData&mission_id=7168">こんな感じ</a>です。</p>
						<p>🔵　クエストの内容からミッション詳細へ飛べるようにしました。</p>
						<p>🟢　訪問済みのリンクを区別するようにデザインを変更しました。</p>
						<p>🔴　表をコピーしたときに、分類がコピーできていなかったのを修正しました。</p>
						<p>🟡　3156さんのマスタを導入しました。</p>
					</aside>
					<aside>
						<h3>2025/05/01</h3>
						<p>🔵　公開しました。<br/>でも宣伝を全然していないので限定公開です。</p>
					</aside>
				</section>
			</article>
		</main>
		<div id="sorting_bg">ソート中…<br/>しばらくお待ちください。</div>
	</body>
	<script>
(async()=> {
"use strict";

const SEASONS = {
	"S108": "https://minesweeper.online/img/candies/candy/528.svg?v4",
	"S112": "https://minesweeper.online/img/candies/egg/408.svg?v5",
/*
	"S116": "https://minesweeper.online/img/candies/drink/468.svg?v4",
*/
};

const SessionStorage = new class{
	#storagename;
	#datas;
	constructor(){
		this.#storagename = "_魚頭男_S004_datas";
/*
		window.addEventListener("beforeunload", this.save);
*/
		this.load();
	}
	get(key){
		return this.#datas[key];
	}
	set(key, value){
		return this.#datas[key] = value;
	}
	has(key){
		return !!this.#datas[key];
	}
	remove(key){
		delete this.#datas[key];
	}
	delete(){
		sessionStorage.removeItem(this.#storagename);
	}
	save(){
		const savedata = JSON.stringify(this.#datas);
		sessionStorage.setItem(this.#storagename, savedata);
	}
	load(){
		const loaddata = sessionStorage.getItem(this.#storagename);
		if(loaddata){
			this.#datas = JSON.parse(loaddata);
		}else{
			this.clear();
		}
	}
	clear(){
		this.#datas = {};
	}
};
const Wait = {
	waits : {},
	add(key){
		return new Promise((resolve) =>{
			this.waits[key] = resolve;
		});
	},
	release(key){
		this.waits[key]();
		delete this.waits[key];
	},
	time(sec){
		return new Promise((resolve) =>{
			setTimeout(function(){resolve();}, sec * 1000);
		});
	},
};
const Menu = new class{
	constructor(){
		this.menu = document.getElementById("menucontent");
		document.getElementById("menuopener").addEventListener("click", this.toggle.bind(this));
		document.getElementById("menuback").addEventListener("click", this.close.bind(this));
		this.menu.addEventListener("click", () => {
			if(event.target.tagName === "A"){
				this.close();
			}
		});
	}
	open(){
		this.menu.classList.add("open");
	}
	close(){
		this.menu.classList.remove("open");
	}
	toggle(){
		this.menu.classList.toggle("open");
	}
	add(dom){
		this.menu.append(dom);
	}
}

const IFURL = new class{	//InterFaceURL
	query = {
		get: (key, url = location) => {
			url = new URL(url);
			return url.searchParams.get(key);
		},
		set: (key, value, url = location) => {
			url = new URL(url);
			url.searchParams.set(key, value);
			return url;
		},
		delete: (key, url = location) => {
			url = new URL(url);
			url.searchParams.delete(key);
			return url;
		},
	}
	pushHistory = (url) => {
		history.pushState({}, "", url);
	}
	replaceHistory = (url) => {
		history.replaceState({}, "", url);
	}
}
class Dialog{
	constructor(param){
		param["opener"].addEventListener("click", () => {
			this.open();
		});
		this.dialog = this.#create();
	}
	#create(){
		const dialog = document.createElement("dialog");
		{
			const article = document.createElement("article");
			dialog.append(article);
		}
		{
			const footer = document.createElement("footer");
			dialog.append(footer);
			{
				const button = document.createElement("button");
				button.type = "button";
				button.textContent = "閉じる";
				button.addEventListener("click", () => {
					this.close();
				});
				footer.append(button);
			}
		}
		
		document.body.append(dialog);
		return dialog;
	}
	open(){
		this.dialog.showModal();
	}
	close(){
		this.dialog.close();
	}
}
function uniqueClassName(className, addDOM){
	const tars = document.querySelectorAll(`.${className}`);
	tars.forEach((tar) => tar.classList.remove(className));
	addDOM?.classList.add(className);
}
function getDateString(date){
	var YYYY = date.getFullYear().toString().padStart(4, '0');
	var MM = (date.getMonth() + 1).toString().padStart(2, '0');
	var DD = date.getDate().toString().padStart(2, '0');
	
	var HH = date.getHours().toString().padStart(2, '0');
	var mm = date.getMinutes().toString().padStart(2, '0');
  return `${YYYY}-${MM}-${DD} ${HH}:${mm}`;
}
function getHayaimogatiDate(date){
	return getDateString(new Date(date * 48000));
}

function sortTable(tar){
	if(tar === event){
		tar = event.target;
	}
	if(tar.tagName !== "TH"){
		return;
	}
	if(!tar.textContent){
		return;
	}
	let func;
	if(tar.dataset.sorted === "1"){
		tar.dataset.sorted = "2";
		func = function(td1, td2){
			if(!(isNaN(td1) && isNaN(td2))){
				td1 = Number(td1);
				td2 = Number(td2);
			}
			return td1 < td2;
		}
	}else{
		tar.dataset.sorted = "1";
		func = function(td1, td2){
			if(!(isNaN(td1) && isNaN(td2))){
				td1 = Number(td1);
				td2 = Number(td2);
			}
			return td1 > td2;
		}
	}
	
	const table = tar.closest("table");
	const ths = table.querySelectorAll("th");
	const thnum = Array.from(ths).findIndex((th) => th === tar) + 1;
	
	const tbody = table.querySelector("tbody");
	const trs = tbody.getElementsByTagName("tr");
	for(let i = 0; i < trs.length; i++){
		let td1 = trs[i].querySelector(`td:nth-child(${thnum})`);
		for(let j = i + 1; j < trs.length; j++){
			const td2 = trs[j].querySelector(`td:nth-child(${thnum})`);
			const ptd1 = td1.dataset.truenum ?? td1.textContent;
			const ptd2 = td2.dataset.truenum ?? td2.textContent;
			if(func(ptd1, ptd2)){
				td1 = td2;
			}
		}
		const tr = td1.closest("tr");
		if(tr !== trs[i]){
			trs[i].insertAdjacentElement("beforebegin", tr);
		}
	}
}
function splitArray(arr, add){
/*
splitArray([1,2,3,4,5], 2) //=> [[1,2], [3,4], [5]]
*/
	const ra = [];
	let startnum = 0;
	let endnum = add;
	while(true){
		const sa = arr.slice(startnum, endnum);
		if(!sa.length){
			break;
		}
		ra.push(sa);
		startnum += add;
		endnum += add;
	}
	return ra;
}


async function getJSON(link){
	const response = await fetch(link);
	return response.json();
}


function getEP(level, rank){
	return RANK_EP[level][rank - 1] ?? level;
}
const full_reconstructFuncs = {
	"J0": function(x, y){
		return `${y}個の${JEMS[x]}を集める`;
	},
	"J1": function(x){
		return `ゲームの報酬で ${x} 個の宝石を集める`;
	},
	"J2": function(x){
		return `${x} 個の宝石を集める`;
	},
	"A0": function(x){
		return `${x} 枚のアリーナチケットを見つける`;
	},
	"A1": function(x){
		return `${x} アリーナコインを稼ぐ`;
	},
	"A2": function(x, y){
		return `L${y} ${ARENAS[x]} のアリーナをクリアする`;
	},
	"A3": function(x){
		return `L${x} 以上のレベルのアリーナをクリアする`;
	},
	"K0": function(x, y, z){
		return `サイズ ${x}x${y}/${z} のカスタムをクリアする`;
	},
	"H0": function(x, y){
		return `レベル  ${MODES[x]} のゲームをヒントなしで ${y} 回クリアする`;
	},
	"H1": function(x, y){
		return `レベル  ${MODES[x]} のゲームを ${y} 秒以内にクリアする`;
	},
	"H2": function(x, y){
		return `レベル  ${MODES[x]} のゲームをフラグなしで ${y} 回クリアする`;
	},
	"H3": function(x, y){
		return `レベル ${MODES[x]} のゲームを ${y} 回連続でクリアする`;
	},
	"H4": function(x, y, z){
		return `レベル ${MODES[x]} のゲームを効率${y}%以上で ${z} 回クリアする`;
	},
	"H5": function(x, y){
		return `レベル ${MODES[x]} のゲームを100回中 ${y} 回クリアする`;
	},
	"H6": function(x, y){
		return `レベル ${MODES[x]} のゲームを24時間以内に ${y} 回クリアする`;
	},
	"H7": function(x, y){
		return `レベル  ${MODES[x]} のゲームを ${y}回クリアする`;
	},
	"M0": function(x){
		return `${x} 名誉ポイントを稼ぐ`;
	},
	"M1": function(x){
		return `ゲームの報酬で ${x} コインを稼ぐ`;
	},
	"M2": function(x){
		return `${x} コインを稼ぐ`;
	},
	"M3": function(x){
		return `イベントポイントを${x}個集める`;
	},
}
const short_reconstructFuncs = {
	"J0": function(x, y){
		return `${JEMS[x]}${y}個`;
	},
	"J1": function(x){
		return `宝石${x}個（ゲーム報酬）`;
	},
	"J2": function(x){
		return `宝石${x}個`;
	},
	"A0": function(x){
		return `アリーナチケット${x}枚`;
	},
	"A1": function(x){
		return `アリーナコイン${x}枚`;
	},
	"A2": function(x, y){
		return `${ARENAS[x]}アリーナL${y}以上`;
	},
	"A3": function(x){
		return `任意のアリーナL${x}以上`;
	},
	"K0": function(x, y, z){
		return `カスタム${x}x${y}/${z}`;
	},
	"H0": function(x, y){
		return `${MODES[x]}ヒントなし${y}回`;
	},
	"H1": function(x, y){
		return `${MODES[x]}${y}秒以内`;
	},
	"H2": function(x, y){
		return `${MODES[x]}フラグなし${y}回`;
	},
	"H3": function(x, y){
		return `${MODES[x]}${y}連`;
	},
	"H4": function(x, y, z){
		return `${MODES[x]}効率${y}%以上${z}回`;
	},
	"H5": function(x, y){
		return `${MODES[x]}習熟${y}`;
	},
	"H6": function(x, y){
		return `${MODES[x]}${y}回（24時間以内）`;
	},
	"H7": function(x, y){
		return `${MODES[x]}${y}回`;
	},
	"M0": function(x){
		return `名誉${x}つ`;
	},
	"M1": function(x){
		return `コイン${x}枚（ゲーム報酬）`;
	},
	"M2": function(x){
		return `コイン${x}枚`;
	},
	"M3": function(x){
		return `イベントポイント${x}つ`;
	},
}
function getDecodeMissionDetail(code){
	const param = code.split("#");
	return short_reconstructFuncs[param["0"]](param["1"], param["2"], param["3"])
}
function createTable(param){
	const tableClassName = `table${param["unityID"]}`;
	
	const table = document.createElement("table");
	table.classList.add(tableClassName);
	{
		const caption = document.createElement("caption");
		caption.innerHTML = param["caption_text"];
		table.append(caption);
		{
			const button = document.createElement("button");
			button.type = "button";
			button.textContent = "⚙️";
			button.classList.add("buttonOpenConfigShowTableCol");
			caption.append(button);
		}
	}
	{
		const thead = document.createElement("thead");
		table.append(thead);
		if(param["isSortable"]){
			table.classList.add("sortTable");
			thead.addEventListener("click", async() => {
				const bg = document.getElementById("sorting_bg");
				bg.classList.add("isShow");
				await new Promise((resolve) => {
					const evt = event.target;
					setTimeout(() => {
						sortTable(evt);
						resolve();
					});
				});
				bg.classList.remove("isShow");
			});
		}
		{
			const tr = document.createElement("tr");
			thead.append(tr);
			param["THS"].forEach((TH) => {
				const th = document.createElement("th");
				th.textContent = TH["name"];
				tr.append(th);
			});
		}
	}
	{
		const tbody = document.createElement("tbody");
		table.append(tbody);
		param["createTbodyFunction"](tbody, param);
	}
	
	const dialogID = `dialog${param["unityID"]}`;
	if(!document.getElementById(dialogID)){
		const od = new class extends Dialog{
			constructor(){
				super({
					"opener": table.querySelector(".buttonOpenConfigShowTableCol"),
				});
				this.#dialogAppend();
			}
			#dialogAppend(){
				const dialog = this.dialog;
				dialog.id = dialogID;
				const style = document.createElement("style");
				document.body.append(style);
				let style_innerHTML = `
					.${tableClassName}{
						${param["style"]}
					}
				`;
				{
					const article = this.dialog.querySelector(":scope > article");
					const ul = document.createElement("ul");
					article.append(ul);
					param["THS"].forEach((TH, index) => {
						const li = document.createElement("li");
						ul.append(li);
						const label = document.createElement("label");
						li.append(label);
						const input = document.createElement("input");
						input.type = "checkbox";
						input.checked = TH["initShow"];
						label.append(input);
						const strong = document.createElement("strong");
						strong.textContent = TH["name"];
						label.append(strong);
						const span = document.createElement("span");
						span.innerText = TH["details"];
						label.append(span);
						
						style_innerHTML += `
							body:has(#${dialogID} > article > ul > li:nth-of-type(${index + 1}) > label > input:not(:checked)) .${tableClassName} > :is(thead, tbody) > tr > :is(th, td):nth-of-type(${index + 1}){
								display: none;
							}
							.${tableClassName} > :is(thead, tbody) > tr > td:nth-of-type(${index + 1}) {
								${TH["style"]}
							}
						`;
					});
					style.innerHTML = style_innerHTML;
				}
				{
					const footer = this.dialog.querySelector(":scope > footer");
				}
			}
		};
	}
	
	return table;
}
function getNumberLevel(level){
	if(level.includes("E")){
		level = level.replace("E", "");
		level = Number(level) * 3;
	}else{
		level = Number(level);
	}
	return level;
}
function getDivision(num1, num2){
	const n1 = Number(num1);
	const n2 = Number(num2);
	const num = Number.parseFloat(n1 / n2);
	if(Number.isNaN(num)){
		return [0, ""];
	}else{
		const n = num.toFixed(2);
		return [n, n];
	}
}
function setPlayerMissions(){
	if(Object.keys(PlayerMissions).length){
		return;
	}
	Object.entries(Missions).forEach(([mid, obj]) => {
		obj["Ws"].forEach((pid, index) => {
			if(!PlayerMissions[pid]){
				PlayerMissions[pid] = [];
			}
			const o = {};
			o["L"] = obj["L"];
			o["level"] = getNumberLevel(o["L"]);
			o["D"] = obj["D"];
			o["I"] = obj["I"];
			o["R"] = index + 1;
			o["P"] = getEP(o["level"], o["R"]);
			o["T"] = obj["T"];
			o["MissionID"] = mid;
			PlayerMissions[pid].push(o);
		});
		
	});
}


const Config = new class extends Dialog{
	constructor(){
		super({
			"opener": document.getElementById("buttonSiteConfig"),
		});
		this.#dialogAppend();
	}
	#dialogAppend(){
		const dialog = this.dialog;
		dialog.id = "configSiteViewing";
		dialog.addEventListener("close", () => {
			const inputs = dialog.querySelectorAll("input");
			inputs.forEach((input) => {
				SessionStorage.set(input.id, input.checked ?? input.value);
			});
			SessionStorage.save();
		});
		{
			const article = dialog.querySelector(":scope > article");
			{
				const fieldset = document.createElement("fieldset");
				fieldset.id = "filterSeason";
				article.append(fieldset);
				const legend = document.createElement("legend");
				legend.textContent = "設定";
				fieldset.append(legend);
				{
					const label = document.createElement("label");
					fieldset.append(label);
					const input = document.createElement("input");
					input.type = "checkbox";
					input.id = "isIgnoreMoreRead";
					input.checked = SessionStorage.get(input.id) ?? false;
					label.append(input);
					const span = document.createElement("span");
					span.textContent = "「さらに読み込む」を無視して一気に読み込む";
					label.append(span);
				}
			}
		}
		{
			const footer = dialog.querySelector(":scope > footer");
		}
	}
}
const Tips = new class extends Dialog{
	constructor(){
		super({
			"opener": document.getElementById("buttonSiteTips"),
		});
		this.#dialogAppend();
	}
	#dialogAppend(){
		const dialog = this.dialog;
		dialog.id = "SiteTips";
		{
			const article = dialog.querySelector(":scope > article");
			article.innerHTML = `
<ul>
	<li>🟢　表の見出しをタップすると並び替えできます。</li>
	<li>🟢　<button onClick='document.getElementById("buttonOpenDataFilter").click();'>🧽 絞り込み</button>内のそれぞれの設定のタイトル（「分類🎁」など）をタップするとすべてのチェックを反転します。</li>
	<li>🟡　<button onClick='document.getElementById("buttonOpenDataFilter").click();'>🧽 絞り込み</button>内でそれぞれの設定を全くチェックしなかった場合、次のようなチェックがされます。
		<dl>
			<dt>シーズン🗓️</dt><dd>最新のシーズンだけチェックされます。</dd>
			<dt>分類🎁</dt><dd>すべての分類がチェックされます。</dd>
			<dt>クエストのレベル⚡️</dt><dd>通常とエリートの両方がチェックされます。</dd>
		</dl>
	</li>
	<li>🟡　<button onClick='document.getElementById("buttonSiteConfig").click();'>⚙️ 設定</button>内の各設定は、そのタブを閉じるまで記憶されます<br/>（sessionStorage）。</li>
</ul>
				
			`;
		}
		{
			const footer = dialog.querySelector(":scope > footer");
		}
	}
}
//========================================

const IMG_DOMAIN = "https://minesweeper.online/img/candies/";

const MSO_CONSTANT = await getJSON("./common/mso_constant.json");
const JEMS = MSO_CONSTANT["JEMS"];
const ARENAS = MSO_CONSTANT["ARENAS"];
const MODES = MSO_CONSTANT["MODES"];

const IMG = await getJSON("./common/img_data.json");
const EVENTPOINT_KIND_NAMES = IMG["EVENTPOINT_KIND_NAMES"];
const EVENTPOINT_KIND_IMAGE_HASHS = IMG["EVENTPOINT_KIND_IMAGE_HASHS"];

const RANK_EP = await getJSON("./common/hayaimonogati_LevelRankEp.json");

const Filter = new class extends Dialog{
	constructor(){
		super({
			"opener": document.getElementById("buttonOpenDataFilter"),
		});
		this.nowFilter = this.getFilter();
		this.#dialogAppend();
		this.setFilter();
	}
	getFilter(){
		const query = IFURL.query.get("filter");
		if(query){
			return query.split("-");
		}else{
			return [];
		}
	}
	setFilter(){
		const fil = this.getQuery();
		IFURL.replaceHistory(IFURL.query.set("filter", fil));
	}
	#dialogAppend(){
		const dialog = this.dialog;
		dialog.id = "configDataFilter";
		dialog.addEventListener("close", this.setConfigs.bind(this));	//エスケープによって閉じたときにも変更を初期化する
		{
			const article = dialog.querySelector(":scope > article");
			{
				const fieldset = document.createElement("fieldset");
				fieldset.id = "filterSeason";
				article.append(fieldset);
				const legend = document.createElement("legend");
				legend.textContent = "シーズン🗓️";
				legend.addEventListener("click", () => {
					fieldset.querySelectorAll("input[type=checkbox]").forEach((chk) => {
						chk.checked = !chk.checked;
					});
				});
				fieldset.append(legend);
				Object.entries(SEASONS).forEach(([season, src]) => {
					const label = document.createElement("label");
					fieldset.append(label);
					const input = document.createElement("input");
					input.type = "checkbox";
					input.dataset.key = season;
					input.checked = this.nowFilter.includes(season);
					label.append(input);
					const img = document.createElement("img");
					img.src = src;
					label.append(img);
					const span = document.createElement("span");
					span.textContent = season;
					label.append(span);
				});
				/*何も✓されていない場合は最新シーズンをあらかじめ選択する*/
				if(fieldset.querySelectorAll("input:checked").length === 0){
					const las = fieldset.querySelector(":scope > label:last-of-type > input");
					las.checked = true;
					this.nowFilter.push(las.dataset.key);
				}
			}
			{
				const fieldset = document.createElement("fieldset");
				fieldset.id = "filterKind";
				article.append(fieldset);
				const legend = document.createElement("legend");
				legend.textContent = "分類🎁";
				legend.addEventListener("click", () => {
					fieldset.querySelectorAll("input[type=checkbox]").forEach((chk) => {
						chk.checked = !chk.checked;
					});
				});
				fieldset.append(legend);
				Object.entries(EVENTPOINT_KIND_NAMES).forEach(([key, value]) => {
					const label = document.createElement("label");
					fieldset.append(label);
					const input = document.createElement("input");
					input.type = "checkbox";
					input.dataset.key = key;
					input.checked = this.nowFilter.includes(key);
					label.append(input);
					const span = document.createElement("span");
					span.textContent = value;
					label.append(span);
				});
				/*何も✓されていない場合はすべての種別をあらかじめ選択する*/
				if(fieldset.querySelectorAll("input:checked").length === 0){
					const chks = fieldset.querySelectorAll("input");
					chks.forEach((chk) => {
						chk.checked = true;
						this.nowFilter.push(chk.dataset.key);
					});
				}
			}
			{
				const fieldset = document.createElement("fieldset");
				fieldset.id = "filterLevel";
				article.append(fieldset);
				const legend = document.createElement("legend");
				legend.textContent = "クエストのレベル⚡️";
				legend.addEventListener("click", () => {
					fieldset.querySelectorAll("input[type=checkbox]").forEach((chk) => {
						chk.checked = !chk.checked;
					});
				});
				fieldset.append(legend);
				const levels = {
					"EOFF": "通常",
					"EON": "エリート",
				};
				Object.entries(levels).forEach(([key, value]) => {
					const label = document.createElement("label");
					fieldset.append(label);
					const input = document.createElement("input");
					input.type = "checkbox";
					input.dataset.key = key;
					input.checked = this.nowFilter.includes(key);
					label.append(input);
					const span = document.createElement("span");
					span.textContent = value;
					label.append(span);
				});
				/*何も✓されていない場合はすべてのレベルをあらかじめ選択する*/
				if(fieldset.querySelectorAll("input:checked").length === 0){
					const chks = fieldset.querySelectorAll("input");
					chks.forEach((chk) => {
						chk.checked = true;
						this.nowFilter.push(chk.dataset.key);
					});
				}
			}
		}
		{
			const footer = dialog.querySelector(":scope > footer");
			footer.querySelector(":scope > button").remove();	/*デフォルトを変更する*/
			{
				const button = document.createElement("button");
				button.type = "button";
				button.textContent = "変更せずに閉じる";
				button.addEventListener("click", () => {
					this.close();
				});
				footer.append(button);
			}
			{
				const button = document.createElement("button");
				button.type = "button";
				button.textContent = "絞り込む";
				button.addEventListener("click", () => {
					this.changeConfigs();
					const url = IFURL.query.set("filter", this.getQuery())
					location.href = url;
				});
				footer.append(button);
			}
		}
	}
	setConfigs(){
		this.dialog.querySelectorAll("input[type=checkbox]").forEach((chk) => {
			chk.checked = this.nowFilter.includes(chk.dataset.key);
		});
	}
	changeConfigs(){
		const sa = [];
		this.dialog.querySelectorAll("input[type=checkbox]:checked").forEach((chk) => {
			sa.push(chk.dataset.key);
		});
		this.nowFilter = sa;
	}
	setHref(article){
		const ancs = article.querySelectorAll("a");
		const fil = this.getQuery();
		ancs.forEach((anc) => {
			anc.href = IFURL.query.set("filter", fil, anc.href);
		});
	}
	getQuery(){
		return this.nowFilter.join("-");
	}
}

let Missions = null;
let Players = null;
let SeasonKindImgs = {};	/*サマリに使う画像*/

let PlayerMissions = {};	/*プレイヤー→ミッション、論理ファイル的扱い*/


async function setUseData(){
	/*データ読み込み*/
	Missions = {};
	Players = {};
	const seasons = Filter.nowFilter.filter((fil) => fil[0] === "S");
	for(let i = 0; i < seasons.length; i++){
		const season = seasons[i];
		const data = await getJSON(`./${season}/data.json`);
		Object.assign(Missions, data["Ms"]);
		Object.assign(Players, data["Ps"]);
	}
	Filter.setHref(Menu.menu);
	
	SeasonKindImgs = (() => {
		const ro = {};
		const basesrc = SEASONS[seasons[0]].replace(/\/\d.+/, "");
		for(const kind of Object.keys(EVENTPOINT_KIND_NAMES)){
			for(const [src, key] of Object.entries(EVENTPOINT_KIND_IMAGE_HASHS)){
				if(src.startsWith(basesrc) && key === kind){
					ro[kind] = src;
				}
			}
		}
		return ro;
	})();
	{
		/*絞り込み内の分類に画像をつける*/
		const chks = document.querySelectorAll("#filterKind > label > input[type=checkbox]");
		chks.forEach((chk) => {
			const img = document.createElement("img");
			img.src = SeasonKindImgs[chk.dataset.key];
			chk.after(img);
		});
	}
	
	/*使わないデータ削除*/
	const EliteFilters = Filter.nowFilter.filter((fil) => fil[0] === "E");
	if(EliteFilters.length === document.querySelectorAll("#filterLevel > label > input[type=checkbox]").length){
		
	}else{
		Object.entries(Missions).forEach(([id, data]) => {
			if(data["L"].at(-1) === "E"){
				if(!EliteFilters.includes("EON")){
					delete Missions[id];
					return;
				}
			}else{
				if(!EliteFilters.includes("EOFF")){
					delete Missions[id];
					return;
				}
			}
		});
	}
	const kindFilters = Filter.nowFilter.filter((fil) => !/[E|S]/.test(fil[0]));
	if(kindFilters.length === document.querySelectorAll("#filterKind > label > input[type=checkbox]").length){
	}else{
		Object.entries(Missions).forEach(([id, data]) => {
			const src = `${IMG_DOMAIN}${data["I"]}`;
			const kind = EVENTPOINT_KIND_IMAGE_HASHS[src];
			if(!kindFilters.includes(kind)){
				delete Missions[id];
				return;
			}
		});
	}
	Object.keys(SeasonKindImgs).forEach((kind) => {
		if(!kindFilters.includes(kind)){
			delete SeasonKindImgs[kind];
		}
	});
}

//========================================
const PageMove = new class{
	constructor(){
		this.before_page = null;
		window.addEventListener("popstate", this.popstate);
		document.addEventListener("click", () => {
			const tar = event.target;
			if(tar.tagName !== "A"){
				return;
			}
			if(tar.hasAttribute("target")){
				return;
			}
			event.preventDefault();
			IFURL.pushHistory(tar.href);
			this.popstate();
		});
	}
	popstate = () => {
		const page = IFURL.query.get("page");
		if(Page[page]){
			if(this.before_page !== page){
				Page[page].show();
			}
			this.before_page = page;
			Page[page].show_expansion();
			if(event?.type === "click"){
				window.scroll({top: 0});
			}
		}else{
			uniqueClassName("sc", document.getElementById("toppage"));
			uniqueClassName("active", Menu.menu.querySelector(":scope > a:nth-of-type(1)"));
		}
	}
}


const Page = {};
class PageData{
	constructor(param){
		this.id = param["id"];
		this.Fields = param["setFields"];
		this.createBody = param["createBody"];
		this.menu = this.#createMenu(param["headerText"]);
		this.article = null;
		for(const [key, value] of Object.entries(param["functions"])){
			this[key] = value;
		}
		this.show_expansion = param["show_expansion"];
		Page[this.id] = this;
	}
	#createMenu = (headerText) => {
		const a = document.createElement("a");
		a.href = `?page=${this.id}`;
		a.textContent = headerText;
		Menu.add(a);
		return a;
	}
	#createArticle = () => {
		if(this.article){
			return;
		}
		const article = document.createElement("article");
		article.id = `Article${this.id}`;
		document.getElementById("MainContent").append(article);
		article.append(this.createBody());
		this.article = article;
	}
	show = () => {
		this.#createArticle();
		uniqueClassName("sc", this.article);
		uniqueClassName("active", this.menu);
	}
}

new PageData({
	id: "PlayerData",
	headerText: "💪 プレイヤー挑戦データ",
	createBody: function(){
		const fragment = document.createDocumentFragment();
		const form = document.createElement("form");
		form.setAttribute("onSubmit", "return false;");
		fragment.append(form);
		{
			const label = document.createElement("label");
			form.append(label);
			const span = document.createElement("span");
			span.textContent = "プレイヤーＩＤ";
			label.append(span);
			const input = document.createElement("input");
			input.id = "inputPlayerID";
			input.type = "number";
			input.min = "0";
			input.step = "1";
			input.value = "16842796";
			label.append(input);
		}
		{
			const button = document.createElement("button");
			button.type = "submit";
			button.textContent = "探す";
			button.addEventListener("click", () => {
				this.main_search();
				const player_id = document.querySelector("#inputPlayerID").value;
				let url = IFURL.query.set("player_id", player_id);
				IFURL.pushHistory(url);
			});
			form.append(button);
		}
		return fragment;
	},
	functions: {
		"main_search": function(){
			const player_id = document.querySelector("#inputPlayerID").value;
			let section;
			if(this.isExist(player_id)){
				section = this.createSection();
			}
			uniqueClassName("sc2", section);
		},
		"isExist": function(player_id){
			if(!player_id){
				return false;
			}
			if(!Players[player_id]){
				alert("プレイヤーがいません。");
				return false;
			}
			return true;
		},
		"popstate_search": function(){
			const player_id = IFURL.query.get("player_id");
			if(player_id){
				document.querySelector("#inputPlayerID").value = player_id;
				this.main_search();
			}
		},
		"createSection": function(){
			const player_id = document.querySelector("#inputPlayerID").value;
			const sectionId = `${this.id}${player_id}`;
			let section = document.getElementById(sectionId);
			if(section){
				return section;
			}
			
			this.datas = PlayerMissions[player_id];	/*全体のデータなどで事前集計しているのならそこを参照する*/
			if(!this.datas){
				this.datas = [];
				const pi = Number(player_id);
				for(const [mission_id, mission_data] of Object.entries(Missions)){
					const index = mission_data["Ws"].indexOf(pi);
					if(index === -1){
						continue;
					}
					
					const o = {};
					o["L"] = mission_data["L"];
					o["level"] = getNumberLevel(o["L"]);
					o["D"] = mission_data["D"];
					o["I"] = mission_data["I"];
					o["R"] = index + 1;
					o["P"] = getEP(o["level"], o["R"]);
					o["T"] = mission_data["T"];
					o["MissionID"] = mission_id;
					this.datas.push(o);
				}
			}
			if(!this.datas.length){
				alert("データがありません…\n絞り込みを変更してみてください。");
				return null;
			}
			
			this.kind_sums = {};
			for(const [kind, src] of Object.entries(SeasonKindImgs)){
				this.kind_sums[kind] = {};
				this.kind_sums[kind]["levels"] = 0;
				this.kind_sums[kind]["eps"] = 0;
				this.kind_sums[kind]["count"] = 0;
				this.kind_sums[kind]["img"] = src;
			}
			
			section = document.createElement("section");
			section.id = sectionId;
			this.article.append(section);
			
			section.append(createTable.call(this, {
				"unityID": "PlayerChallengeData",
				"caption_text": `<b>${Players[player_id]}</b>さんのクエストデータ`,
				"isSortable": true,
				"style": `
				`,
				"THS": [
					{
						"name": "レベル⚡️",
						"details": "クエストのレベル（＝挑戦するのに必要なアクティビティ数）です。",
						"initShow": true,
						"style": `
						`,
						"makeTD": (td, data) => {
							td.textContent = `L${data["L"]}`;
							td.dataset.truenum = data["level"];
						},
					},
					{
						"name": "内容",
						"details": "クエストの内容です。",
						"initShow": true,
						"style": `
						`,
						"makeTD": (td, data) => {
							const a = document.createElement("a");
							a.href = `?page=MissionData&mission_id=${data["MissionID"]}`;
							a.textContent = getDecodeMissionDetail(data["D"]);
							td.append(a);
/*
							td.textContent = getDecodeMissionDetail(data["D"]);
*/
						},
					},
					{
						"name": "分類",
						"details": "クエストで得られるEPの分類です。",
						"initShow": true,
						"style": `
							text-align: center;
						`,
						"makeTD": (td, data) => {
							const src = `${IMG_DOMAIN}${data["I"]}`;
							const kind = EVENTPOINT_KIND_IMAGE_HASHS[src]
							td.dataset.truenum = kind;
							const img = document.createElement("img");
							img.src = src;
							img.setAttribute("alt", EVENTPOINT_KIND_NAMES[kind]);
							td.append(img);
						},
					},
					{
						"name": "順位👑",
						"details": "クリアした順位です。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							const a = document.createElement("a");
							a.href = `?page=MissionData&mission_id=${data["MissionID"]}`;
							a.textContent = data["R"];
							td.append(a);
						},
					},
					{
						"name": "EP🍬",
						"details": "獲得したEP数です。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							td.textContent = data["P"];
						},
					},
					{
						"name": "🍬/⚡️",
						"details": "1レベルあたりの獲得EPです。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							[td.dataset.truenum, td.textContent] = getDivision(data["P"], data["level"]);
						},
					},
					{
						"name": "開催時刻",
						"details": "クエストが開催された時刻です。",
						"initShow": false,
						"style": `
						`,
						"makeTD": (td, data) => {
							td.textContent = getHayaimogatiDate(data["T"]);
						},
					},
				],
				"createTbodyFunction": (tbody, param) => {
					this.datas.forEach((data) => {
						const src = `${IMG_DOMAIN}${data["I"]}`;
						const kind = EVENTPOINT_KIND_IMAGE_HASHS[src];
						this.kind_sums[kind]["levels"] += data["level"];
						this.kind_sums[kind]["eps"] += Number(data["P"]);
						this.kind_sums[kind]["count"] += 1;
						
						const tr = document.createElement("tr");
						tbody.append(tr);
						param["THS"].forEach((TH) => {
							const td = document.createElement("td");
							TH["makeTD"](td, data);
							tr.append(td);
						});
					});
				},
			}));
			
			
			section.append(createTable.call(this, {
				"unityID": "PlayerChallengeSummary",
				"caption_text": `<b>${Players[player_id]}</b>さんのデータまとめ`,
				"isSortable": true,
				"style": `
					order: -1;
				`,
				"THS": [
					{
						"name": "分類",
						"details": "クエストで得られるEPの分類です。",
						"initShow": true,
						"style": `
						`,
						"makeTD": (td, data) => {
							td.dataset.truenum = data[2]
							if(data[1]){
								const img = document.createElement("img");
								img.src = data[1];
								td.append(img);
							}
							const span = document.createElement("span");
							span.textContent = data[0];
							td.append(span);
						},
					},
					{
						"name": "mission🪧",
						"details": "クリアしたクエスト数です。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							td.textContent = data[5];
						},
					},
					{
						"name": "レベル⚡️",
						"details": "クエストのレベル（＝挑戦するのに必要なアクティビティ数）です。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							td.textContent = data[3];
						},
					},
					{
						"name": "EP🍬",
						"details": "獲得したEP数です。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							td.textContent = data[4];
						},
					},
					{
						"name": "🍬/⚡️",
						"details": "1レベルあたりの獲得EPです。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							[td.dataset.truenum, td.textContent] = getDivision(data[4], data[3]);
						},
					},
					{
						"name": "🍬/🪧",
						"details": "1クエストあたりの獲得EPです。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							[td.dataset.truenum, td.textContent] = getDivision(data[4], data[5]);
						},
					},
				],
				"createTbodyFunction": (tbody, param) => {
					const summaryDatas = [];
					{
						let s_levels = 0;
						let s_eps = 0;
						let s_count = 0;
						for(const [key, value] of Object.entries(this.kind_sums)){
							summaryDatas.push([EVENTPOINT_KIND_NAMES[key], value["img"], key, value["levels"], value["eps"], value["count"]]);
							s_levels += value["levels"];
							s_eps += value["eps"];
							s_count += value["count"];
						}
						summaryDatas.push(["＊合計", "", "ZZ", s_levels, s_eps, s_count]);
					}
					summaryDatas.forEach((data) => {
						const tr = document.createElement("tr");
						tbody.append(tr);
						param["THS"].forEach((TH) => {
							const td = document.createElement("td");
							TH["makeTD"](td, data);
							tr.append(td);
						});
					});
				},
			}));
			Filter.setHref(section);
			return section;
		},
	},
	show_expansion: function(){
		this.popstate_search();
	},
});
new PageData({
	id: "MissionData",
	headerText: "🪧 ミッションデータ",
	createBody: function(){
		const fragment = document.createDocumentFragment();
		const form = document.createElement("form");
		form.setAttribute("onSubmit", "return false;");
		fragment.append(form);
		{
			const label = document.createElement("label");
			form.append(label);
			const span = document.createElement("span");
			span.textContent = "ミッションＩＤ";
			label.append(span);
			const input = document.createElement("input");
			input.id = "inputMissionID";
			input.type = "number";
			input.min = "0";
			input.step = "1";
			input.value = Object.keys(Missions)[0];
			label.append(input);
		}
		{
			const button = document.createElement("button");
			button.type = "submit";
			button.textContent = "探す";
			button.addEventListener("click", () => {
				this.mainSearch_target();
				const mission_id = document.querySelector("#inputMissionID").value;
				let url = IFURL.query.set("mission_id", mission_id);
				IFURL.pushHistory(url);
			});
			form.append(button);
		}
		{
			const button = document.createElement("button");
			button.type = "submit";
			button.textContent = "全部見る";
			button.addEventListener("click", () => {
				this.mainSearch_all();
				const mission_id = document.querySelector("#inputMissionID").value;
				let url = IFURL.query.set("page", this.id);
				url = IFURL.query.delete("mission_id", url);
				IFURL.pushHistory(url);
			});
			form.append(button);
		}
		return fragment;
	},
	functions: {
		"mainSearch_target": function(){
			const mission_id = document.querySelector("#inputMissionID").value;
			let section = null;
			if(this.isExist(mission_id)){
				section = this.createSection_target();
			}
			uniqueClassName("sc2", section);
		},
		"mainSearch_all": function(){
			const section = this.createSection_all();
			uniqueClassName("sc2", section);
		},
		"isExist": function(mission_id){
			if(!mission_id){
				return false;
			}
			if(!Missions[mission_id]){
				alert(`ミッションＩＤ「${mission_id}」はありません。`);
				return false;
			}
			return true;
		},
		"popstate_search": function(){
			const mission_id = IFURL.query.get("mission_id");
			if(mission_id){
				document.querySelector("#inputMissionID").value = mission_id;
				this.mainSearch_target();
			}else{
				this.mainSearch_all();
			}
		},
		"createSection_all": function(){
			const sectionId = `${this.id}AllMission`;
			let section = document.getElementById(sectionId);
			if(section){
				return section;
			}
			
			this.datas = [];
			for(const [key, value] of Object.entries(Missions)){
				const o = {};
				o["ID"] = key;
				o["L"] = value["L"];
				o["level"] = getNumberLevel(o["L"]);
				o["D"] = value["D"];
				o["I"] = value["I"];
				o["S"] = value["S"];
				o["T"] = value["T"];
				o["Ws"] = value["Ws"];
				this.datas.push(o);
			}
			if(!this.datas.length){
				alert("データがありません…\n絞り込みを変更してみてください。");
				return null;
			}
			
			this.kind_sums = {};
			for(const [kind, src] of Object.entries(SeasonKindImgs)){
				this.kind_sums[kind] = {};
				this.kind_sums[kind]["levels"] = 0;
				this.kind_sums[kind]["winners"] = 0;
				this.kind_sums[kind]["count"] = 0;
				this.kind_sums[kind]["img"] = src;
			}
			
			section = document.createElement("section");
			section.id = sectionId;
			this.article.append(section);
			
			section.append(createTable.call(this, {
				"unityID": "AllMissionData",
				"caption_text": "ミッションデータ一覧",
				"isSortable": true,
				"style": `
				`,
				"THS": [
					{
						"name": "ID",
						"details": "クエストのIDです。",
						"initShow": false,
						"style": `
						`,
						"makeTD": (td, data) => {
							const a = document.createElement("a");
							a.href = `?page=${this.id}&mission_id=${data["ID"]}`;
							a.textContent = data["ID"];
							td.append(a);
						},
					},
					{
						"name": "レベル⚡️",
						"details": "クエストのレベル（＝挑戦するのに必要なアクティビティ数）です。",
						"initShow": true,
						"style": `
						`,
						"makeTD": (td, data) => {
							td.textContent = `L${data["L"]}`;
							td.dataset.truenum = data["level"];
						},
					},
					{
						"name": "内容",
						"details": "クエストの内容です。",
						"initShow": true,
						"style": `
						`,
						"makeTD": (td, data) => {
							const a = document.createElement("a");
							a.href = `?page=${this.id}&mission_id=${data["ID"]}`;
							a.textContent = getDecodeMissionDetail(data["D"]);
							td.append(a);
/*
							td.textContent = getDecodeMissionDetail(data["D"]);
*/
						},
					},
					{
						"name": "分類",
						"details": "クエストで得られるEPの分類です。",
						"initShow": true,
						"style": `
							text-align: center;
						`,
						"makeTD": (td, data) => {
							const src = `${IMG_DOMAIN}${data["I"]}`;
							td.dataset.truenum = EVENTPOINT_KIND_IMAGE_HASHS[src];
							const img = document.createElement("img");
							img.src = src;
							img.setAttribute("alt", EVENTPOINT_KIND_NAMES[td.dataset.truenum]);
							td.append(img);
						},
					},
					{
						"name": "勝者",
						"details": "クエストの勝者数です。",
						"initShow": false,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							td.textContent = data["Ws"].length;
/*
							const a = document.createElement("a");
							a.href = `?page=MissionData&mission_id=${data["ID"]}`;
							a.textContent = data["Ws"].length;
							td.append(a);
*/
						},
					},
					{
						"name": "1.0倍ライン",
						"details": "EP/LEVELが1.0となる順位です。",
						"initShow": false,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							td.textContent = RANK_EP[data["level"]].length;
						},
					},
					{
						"name": "人気度(%)",
						"details": "1.0倍ラインに対するクリアしたプレイヤーの割合です。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							[td.dataset.truenum, td.textContent] = getDivision(data["Ws"].length * 100, RANK_EP[data["level"]].length);
						},
					},
					{
						"name": "最終🍬/⚡️",
						"details": "最後にクリアしたプレイヤーのEP/LEVELです。",
						"initShow": false,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							[td.dataset.truenum, td.textContent] = getDivision(getEP(data["level"], data["Ws"].length), data["level"]);
						},
					},
					{
						"name": "開催時刻",
						"details": "クエストが開催された時刻です。",
						"initShow": false,
						"style": `
						`,
						"makeTD": (td, data) => {
							td.textContent = getHayaimogatiDate(data["T"]);
						},
					},
					{
						"name": "シーズン",
						"details": "クエストが開催されたシーズンです。",
						"initShow": false,
						"style": `
						`,
						"makeTD": (td, data) => {
							td.textContent = `S${data["S"]}`;
						},
					},
				],
				"createTbodyFunction": (tbody, param) => {
					this.datas.forEach((data) => {
						const src = `${IMG_DOMAIN}${data["I"]}`;
						const kind = EVENTPOINT_KIND_IMAGE_HASHS[src];
						this.kind_sums[kind]["levels"] += data["level"];
						this.kind_sums[kind]["winners"] += data["Ws"].length;
						this.kind_sums[kind]["count"] += 1;
						
						const tr = document.createElement("tr");
						tbody.append(tr);
						param["THS"].forEach((TH) => {
							const td = document.createElement("td");
							TH["makeTD"](td, data);
							tr.append(td);
						});
					});
				},
			}));

			/*まとめテーブル作成*/
			section.append(createTable.call(this, {
				"unityID": "AllMissionSummary",
				"caption_text": "ミッションデータまとめ",
				"isSortable": true,
				"style": `
					order: -1;
				`,
				"THS": [
					{
						"name": "分類",
						"details": "クエストで得られるEPの分類です。",
						"initShow": true,
						"style": `
						`,
						"makeTD": (td, data) => {
							td.dataset.truenum = data[2]
							if(data[1]){
								const img = document.createElement("img");
								img.src = data[1];
								td.append(img);
							}
							const span = document.createElement("span");
							span.textContent = data[0];
							td.append(span);
						},
					},
					{
						"name": "mission🪧",
						"details": "公開されたクエスト数です。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							td.textContent = data[5];
						},
					},
					{
						"name": "レベル⚡️",
						"details": "クエストのレベル（＝挑戦するのに必要なアクティビティ数）です。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							td.textContent = data[3];
						},
					},
					{
						"name": "勝者",
						"details": "クエストの勝者数です。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							td.textContent = data[4];
						},
					},
				],
				"createTbodyFunction": (tbody, param) => {
					const summaryDatas = [];
					{
						let s_levels = 0;
						let s_winners = 0;
						let s_count = 0;
						for(const [key, value] of Object.entries(this.kind_sums)){
							summaryDatas.push([EVENTPOINT_KIND_NAMES[key], value["img"], key, value["levels"], value["winners"], value["count"]]);
							s_levels += value["levels"];
							s_winners += value["winners"];
							s_count += value["count"];
						}
						summaryDatas.push(["＊合計", "", "ZZ", s_levels, s_winners, s_count]);
					}
					summaryDatas.forEach((data) => {
						const tr = document.createElement("tr");
						tbody.append(tr);
						param["THS"].forEach((TH) => {
							const td = document.createElement("td");
							TH["makeTD"](td, data);
							tr.append(td);
						});
					});
				},
			}));
			Filter.setHref(section);
			return section;
		},
		
		
		"createSection_target": function(){
			const mission_id = document.querySelector("#inputMissionID").value;
			const sectionId = `${this.id}${mission_id}`;
			let section = document.getElementById(sectionId);
			if(section){
				return section;
			}
			
			const data = Missions[mission_id];
			data["level"] = getNumberLevel(data["L"]);
			
			section = document.createElement("section");
			section.id = sectionId;
			this.article.append(section);
			
			section.append(createTable.call(this, {
				"unityID": "TargetMissionDetail",
				"caption_text": `ミッション「<b>${mission_id}</b>」のデータ`,
				"isSortable": false,
				"style": `
				`,
				"THS": [
					{
						"name": "レベル⚡️",
						"details": "クエストのレベル（＝挑戦するのに必要なアクティビティ数）です。",
						"initShow": true,
						"style": `
						`,
						"makeTD": (td, data) => {
							td.textContent = `L${data["L"]}`;
							td.dataset.truenum = data["level"];
						},
					},
					{
						"name": "内容",
						"details": "クエストの内容です。",
						"initShow": true,
						"style": `
						`,
						"makeTD": (td, data) => {
							const param = data["D"].split("#");
							let text = full_reconstructFuncs[param["0"]](param["1"], param["2"], param["3"]);
							if(text.includes("カスタム")){
								const mat = text.match(/\d+x\d+\/\d+/)[0];
								text = text.replace(mat, `<a href="https://minesweeper.online/ja/start/${mat}" target="_blank" rel="noopener noreferrer">${mat}</a>`);
							}
							td.innerHTML = text;
							
						},
					},
					{
						"name": "分類",
						"details": "クエストで得られるEPの分類です。",
						"initShow": true,
						"style": `
							text-align: center;
						`,
						"makeTD": (td, data) => {
							const src = `${IMG_DOMAIN}${data["I"]}`;
							const kind = EVENTPOINT_KIND_IMAGE_HASHS[src]
							td.dataset.truenum = kind;
							const img = document.createElement("img");
							img.src = src;
							img.setAttribute("alt", EVENTPOINT_KIND_NAMES[kind]);
							td.append(img);
						},
					},
					{
						"name": "勝者",
						"details": "クエストの勝者数です。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data) => {
							td.textContent = data["Ws"].length;
						},
					},
					{
						"name": "シーズン",
						"details": "クエストが開催されたシーズンです。",
						"initShow": true,
						"style": `
						`,
						"makeTD": (td, data) => {
							td.textContent = `S${data["S"]}`;
						},
					},
					{
						"name": "開催時刻",
						"details": "クエストが開催された時刻です。",
						"initShow": true,
						"style": `
						`,
						"makeTD": (td, data) => {
							td.textContent = getHayaimogatiDate(data["T"]);
						},
					},
				],
				"createTbodyFunction": (tbody, param) => {
					const tr = document.createElement("tr");
					tbody.append(tr);
					param["THS"].forEach((TH) => {
						const td = document.createElement("td");
						TH["makeTD"](td, data);
						tr.append(td);
					});
				},
			}));
			
			
			section.append(createTable.call(this, {
				"unityID": "TargetMissionWinners",
				"caption_text": `ミッション「<b>${mission_id}</b>」の勝者データ`,
				"isSortable": false,
				"style": `
				`,
				"THS": [
					{
						"name": "順位👑",
						"details": "クエストをクリアした順位です。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, data, rank) => {
							td.textContent = rank;
						},
					},
					{
						"name": "プレイヤー",
						"details": "プレイヤー名です。",
						"initShow": true,
						"style": `
						`,
						"makeTD": (td, pid, rank) => {
							const a = document.createElement("a");
							a.href = `?page=PlayerData&player_id=${pid}`;
							a.textContent = Players[pid];
							td.append(a);
						},
					},
					{
						"name": "EP🍬",
						"details": "獲得したEPです。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, pid, rank) => {
							td.textContent = getEP(data["level"], rank);
						},
					},
					{
						"name": "🍬/⚡️",
						"details": "1レベルあたりの獲得EPです。",
						"initShow": true,
						"style": `
							text-align: right;
						`,
						"makeTD": (td, pid, rank) => {
							[td.dataset.truenum, td.textContent] = getDivision(getEP(data["level"], rank), data["level"]);
						},
					},
				],
				"createTbodyFunction": async(tbody, param) => {
					const newMap = splitArray(data["Ws"], 100);
					const morereadId = `buttonMoreRead${this.id}${mission_id}`;
					let rank = 0;
					for(let i = 0; i < newMap.length; i++){
						newMap[i].forEach((pid) => {
							rank++;
							const tr = document.createElement("tr");
							tbody.append(tr);
							param["THS"].forEach((TH) => {
								const td = document.createElement("td");
								TH["makeTD"](td, pid, rank);
								tr.append(td);
							});
						});
						
						if(i === newMap.length - 1){
							break;
						}
						if(!document.getElementById("isIgnoreMoreRead").checked){
							let button = document.getElementById(morereadId);
							if(!button){
								const button = document.createElement("button");
								button.type = "button";
								button.id = morereadId;
								button.classList.add("buttonMoreRead");
								button.textContent = "さらに読み込む";
								button.addEventListener("click", () => {
									Wait.release(morereadId);
								});
								const caption = document.createElement("caption");
								caption.append(button);
								tbody.closest("table").append(caption);
							}
							await Wait.add(morereadId);
						}
						
					}
					document.getElementById(morereadId)?.remove();
				},
			}));
			Filter.setHref(section);
			return section;
		},
	},
	show_expansion: function(){
		this.popstate_search();
	},
});
new PageData({
	id: "AllData",
	headerText: "🗂️ 全体のデータ",
	setFields: {
		"summarys": {
			"A0": {
				"string": "ミッション内容ごとの平均人気度",
				"create": function(){
					this.datas = {};
					Object.entries(Missions).forEach(([id, obj]) => {
						if(!this.datas[obj["D"]]){
							this.datas[obj["D"]] = {};
							this.datas[obj["D"]]["ids"] = [];
							this.datas[obj["D"]]["pops"] = [];
							this.datas[obj["D"]]["s_pops"] = 0;
						}
						const level = getNumberLevel(obj["L"]);
						this.datas[obj["D"]]["ids"].push(id);
						const calc = getDivision(obj["Ws"].length * 100, RANK_EP[level].length)[0];
						this.datas[obj["D"]]["pops"].push(calc);
						this.datas[obj["D"]]["s_pops"] += Number(calc);
					});
					
					if(!Object.keys(this.datas).length){
						alert("データがありません…\n絞り込みを変更してみてください。");
						return;
					}
					
					const table = createTable.call(this, {
						"unityID": "PopulalyPerMissionDetail",
						"caption_text": `<b>${this.Fields["summarys"]["A0"]["string"]}</b>`,
						"isSortable": true,
						"style": `
						`,
						"THS": [
							{
								"name": "内容",
								"details": "クエストの内容です。",
								"initShow": true,
								"style": `
								`,
								"makeTD": (td, key, data) => {
									td.textContent = getDecodeMissionDetail(key);
								},
							},
							{
								"name": "ID",
								"details": "クエストのIDです。\nソートは該当クエスト数で行われます。",
								"initShow": true,
								"style": `
								`,
								"makeTD": (td, key, data) => {
									const ul = document.createElement("ul");
									td.append(ul);
									data["ids"].forEach((id) => {
										const li = document.createElement("li");
										ul.append(li);
										const img = document.createElement("img");
										img.src = `${IMG_DOMAIN}${Missions[id]["I"]}`;
										li.append(img);
										const a = document.createElement("a");
										a.href = `?page=MissionData&mission_id=${id}`;
										a.textContent = id;
										li.append(a);
									});
									td.dataset.truenum = data["ids"].length;
								},
							},
							{
								"name": "人気度(%)",
								"details": "1.0倍ラインに対するクリアしたプレイヤーの割合です。",
								"initShow": false,
								"style": `
									text-align: right;
								`,
								"makeTD": (td, key, data) => {
									const ul = document.createElement("ul");
									td.append(ul);
									data["pops"].forEach((pop) => {
										const li = document.createElement("li");
										ul.append(li);
										const span = document.createElement("span");
										span.textContent = pop;
										li.append(span);
									});
									td.dataset.truenum = data["pops"].length;
								},
							},
							{
								"name": "平均人気度(%)",
								"details": "1.0倍ラインに対するクリアしたプレイヤーの割合です。",
								"initShow": true,
								"style": `
									text-align: right;
								`,
								"makeTD": (td, key, data) => {
									[td.dataset.truenum, td.textContent] = getDivision(data["s_pops"], data["ids"].length);
								},
							},
						],
						"createTbodyFunction": (tbody, param) => {
							Object.entries(this.datas).forEach(([key, data]) => {
								const tr = document.createElement("tr");
								tbody.append(tr);
								param["THS"].forEach((TH) => {
									const td = document.createElement("td");
									TH["makeTD"](td, key, data);
									tr.append(td);
								});
							});
						},
					});
					return table;
				}
			},
			
			"B0": {
//同率順位でブレイクしないバージョン
				"string": "プレイヤーランキング（クリアクエスト数）",
				"create": function(){
					this.arrs = [];
					Object.entries(PlayerMissions).forEach(([pid, mds]) => {
						this.arrs.push([pid, mds.length]);
					});
					if(!this.arrs.length){
						alert("データがありません…\n絞り込みを変更してみてください。");
						return;
					}
					this.arrs.sort(function(a,b){
						if(a[1] < b[1]){
							return 1;
						}else{
							return -1;
						}
					});
					
					const table = createTable.call(this, {
						"unityID": "RankingPlayerCompleteMissionCount",
						"caption_text": `<b>${this.Fields["summarys"]["B0"]["string"]}</b>`,
						"isSortable": false,
						"style": `
						`,
						"THS": [
							{
								"name": "順位👑",
								"details": "クリアしたクエスト数の多さ順です。",
								"initShow": true,
								"style": `
									text-align: right;
								`,
								"makeTD": (td, key, data) => {
									td.textContent = data["rank"];
								},
							},
							{
								"name": "プレイヤー",
								"details": "プレイヤー名です。",
								"initShow": true,
								"style": `
								`,
								"makeTD": (td, key, data) => {
									const a = document.createElement("a");
									a.href = `?page=PlayerData&player_id=${key}`;
									a.textContent = Players[key];
									td.append(a);
								},
							},
							{
								"name": "mission🪧",
								"details": "クリアしたクエスト数です。",
								"initShow": true,
								"style": `
									text-align: right;
								`,
								"makeTD": (td, key, data) => {
									td.textContent = data["count"];
								},
							},
							{
								"name": "クリア率(%)",
								"details": "すべてのクエスト数に対するクリアしたクエスト数です。\nエリートと通常のクエストを両方抽出している場合は、その半分を総数としています（片方しか挑戦できないため）。",
								"initShow": true,
								"style": `
									text-align: right;
								`,
								"makeTD": (td, key, data) => {
									[td.dataset.truenum, td.textContent] = getDivision(data["count"]*100, this.challengableMissions);
								},
							},
						],
						"createTbodyFunction": async(tbody, param) => {
							let bcount = 0;
							let rank = 0;
							let add = 1;
							let limitrank = 100;
							const morereadId = "buttonMoreReadB0";
							for(let i = 0; i < this.arrs.length; i++){
								const arr = this.arrs[i];
								const key = arr[0];
								const count = arr[1];
								if(bcount !== count){
									bcount = count;
									rank += add;
									add = 1;
								}else{
									add++;
								}
								if(rank > limitrank){
									if(!document.getElementById("isIgnoreMoreRead").checked){
										if(rank - limitrank > 100){
											limitrank = rank;
										}else{
											limitrank += 100;
										}
										let button = document.getElementById(morereadId);
										if(!button){
											const button = document.createElement("button");
											button.type = "button";
											button.id = morereadId;
											button.classList.add("buttonMoreRead");
											button.textContent = "さらに読み込む";
											button.addEventListener("click", () => {
												Wait.release(morereadId);
											});
											const caption = document.createElement("caption");
											caption.append(button);
											tbody.closest("table").append(caption);
										}
										await Wait.add(morereadId);
									}
								}
								
								const data = {
									"rank": rank,
									"count": count,
								}
								const tr = document.createElement("tr");
								tbody.append(tr);
								param["THS"].forEach((TH) => {
									const td = document.createElement("td");
									TH["makeTD"](td, key, data);
									tr.append(td);
								});
							}
							document.getElementById(morereadId)?.remove();
						},
						
					});
					return table;
				}
			},
			"B01": {
//同率順位でブレイクするバージョン
				"string": "プレイヤーランキング（クリアクエスト数_break）",
				"create": function(){
					this.arrs = [];
					Object.entries(PlayerMissions).forEach(([pid, mds]) => {
						this.arrs.push([pid, mds.length]);
					});
					
					if(!this.arrs.length){
						alert("データがありません…\n絞り込みを変更してみてください。");
						return;
					}
					this.arrs.sort(function(a,b){
						if(a[1] < b[1]){
							return 1;
						}else{
							return -1;
						}
					});
					
					
					const table = createTable.call(this, {
						"unityID": "RankingPlayerCompleteMissionCount_break",
						"caption_text": `<b>${this.Fields["summarys"]["B01"]["string"]}</b>`,
						"isSortable": false,
						"style": `
						`,
						"THS": [
							{
								"name": "順位👑",
								"details": "クリアしたクエスト数の多さ順です。",
								"initShow": true,
								"style": `
									text-align: right;
								`,
								"makeTD": (td, key, data) => {
									const span = document.createElement("span");
									span.textContent = data["rank"];
									td.append(span);
								},
							},
							{
								"name": "プレイヤー",
								"details": "プレイヤー名です。",
								"initShow": true,
								"style": `
								`,
								"makeTD": (td, pids, data) => {
									const ul = document.createElement("ul");
									td.append(ul);
									pids.forEach((pid) => {
										const li = document.createElement("li");
										ul.append(li);
										const a = document.createElement("a");
										a.href = `?page=PlayerData&player_id=${pid}`;
										a.textContent = Players[pid];
										li.append(a);
									});
									td.dataset.truenum = pids.length;
								},
							},
							{
								"name": "mission🪧",
								"details": "クリアしたクエスト数です。",
								"initShow": true,
								"style": `
									text-align: right;
								`,
								"makeTD": (td, pids, data) => {
									const span = document.createElement("span");
									span.textContent = data["count"];
									td.append(span);
								},
							},
							{
								"name": "クリア率(%)",
								"details": "すべてのクエスト数に対するクリアしたクエスト数です。\nエリートと通常のクエストを両方抽出している場合は、その半分を総数としています（片方しか挑戦できないため）。",
								"initShow": true,
								"style": `
									text-align: right;
								`,
								"makeTD": (td, pids, data) => {
									const span = document.createElement("span");
									[td.dataset.truenum, span.textContent] = getDivision(data["count"]*100, this.challengableMissions);
									td.append(span);
								},
							},
						],
						"createTbodyFunction": async(tbody, param) => {
							const putFunc = function(){
								const data = {
									"rank": rank,
									"count": bcount,
								}
								const tr = document.createElement("tr");
								tbody.append(tr);
								param["THS"].forEach((TH) => {
									const td = document.createElement("td");
									TH["makeTD"](td, pids, data);
									tr.append(td);
								});
							};
							let pids = [];
							let bcount = this.arrs[0][1];
							let rank = 1;
							let add = 0;
							const morereadId = "buttonMoreReadB01";
							let limitrank = 100;
							for(let i = 0; i < this.arrs.length; i++){
								const arr = this.arrs[i];
								const pid = arr[0];
								const count = arr[1];
								if(bcount !== count){
									putFunc();
									bcount = count;
									rank += add;
									add = 0;
									pids = [];
									
									if(rank > limitrank){
										if(!document.getElementById("isIgnoreMoreRead").checked){
											if(rank - limitrank > 100){
												limitrank = rank;
											}else{
												limitrank += 100;
											}
											let button = document.getElementById(morereadId);
											if(!button){
												const button = document.createElement("button");
												button.type = "button";
												button.id = morereadId;
												button.classList.add("buttonMoreRead");
												button.textContent = "さらに読み込む";
												button.addEventListener("click", () => {
													Wait.release(morereadId);
												});
												const caption = document.createElement("caption");
												caption.append(button);
												tbody.closest("table").append(caption);
											}
											await Wait.add(morereadId);
										}
									}
									
								}
								add++;
								pids.push(pid);
							}
							putFunc();
							document.getElementById(morereadId)?.remove();
						}
						
					});
					return table;
				}
			},
		},
	},
	createBody: function(){
		const fragment = document.createDocumentFragment();
		{
			const aside = document.createElement("aside");
			aside.id = `aside${this.id}List`;
			fragment.append(aside);
			const ul = document.createElement("ul");
			aside.append(ul);
			Object.entries(this.Fields["summarys"]).forEach(([id, obj]) => {
				const li = document.createElement("li");
				ul.append(li);
				const a = document.createElement("a");
				a.textContent = obj["string"];
				a.href = `?page=${this.id}&summary_id=${id}`;
				li.append(a);
			});
			Filter.setHref(ul);
		}
		{
			setPlayerMissions();
			this.maxMissions = Object.keys(Missions).length;
			this.challengableMissions = this.maxMissions / document.querySelectorAll("#filterLevel input[type=checkbox]:checked").length;
			
			const dl = document.createElement("dl");
			dl.classList.add("tableDetail");
			fragment.append(dl);
			const dls = [
				["プレイヤー数", Object.keys(PlayerMissions).length],
				["ミッション数", this.maxMissions],
				["挑戦可能なミッション数", this.challengableMissions],
			];
			dls.forEach((ele) => {
				const dt = document.createElement("dt");
				dt.textContent = ele[0];
				dl.append(dt);
				const dd = document.createElement("dd");
				dd.textContent = ele[1];
				dl.append(dd);
			});
		}
		return fragment;
	},
	functions: {
		"popstate": function(){
			const id = IFURL.query.get("summary_id");
			let section = null;
			if(this.Fields["summarys"][id]){
				section = this.createTargetSummary(id);
			}
			uniqueClassName("sc2", section);
		},
		"createTargetSummary": function(id){
			const sectionId = `${this.id}_${id}`;
			let section = document.getElementById(sectionId);
			if(!section){
				const dom = this.Fields["summarys"][id]["create"].call(this);
				if(!dom){
					return;
				}
				section = document.createElement("section");
				section.id = sectionId;
				this.article.append(section);
				section.append(dom);
				Filter.setHref(dom);
			}
			return section;
		}
	},
	show_expansion: function(){
		this.popstate();
	},
});



async function startUp(){
	await setUseData();
	PageMove.popstate();
}
startUp();

})();



  </script>
</html>
